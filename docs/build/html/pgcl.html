<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>prodigy.pgcl &#8212; Prodigy  documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/katex-math.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js"></script>
    <script src="_static/katex_autorenderer.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="prodigy.pysmt" href="pysmt.html" />
    <link rel="prev" title="Prodigy Documentation" href="index.html" />
    
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="_static/bootstrap-sphinx.js "></script>

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;1,400&family=Source+Serif+Pro:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        body {
            font: 15px/1.4 "Source Sans Pro",sans-serif;
        }
        h1, h2, h3, h5, h6, h6 {
            font-family: "Source Sans Pro",sans-serif;
        }
        p {
            font-family: "Source Serif Pro",serif;
        }
        .py, .field-list p, pre, code {
            font-family: 'Source Code Pro', monospace;
        }

        /* fix navbar overlaying contents when clicking on anchors */
        :target::before {
            content: "";
            display: block;
            height: 60px; /* fixed header height*/
            margin: -60px 0 0; /* negative fixed header height */
            background: none;
        }

        /* hack to limit the yellow highlight to the the children of the target,
           because of the above hack the target's highlight would be way too large */
        dt:target {
            background-color: transparent;
        }
        dt:target > * {
            background-color: #fbe54e;
        }

        /* spacing adjustments */
        .section {
            margin-bottom: 10rem;
            margin-top: 6rem;
        }
        div.body > .section:first-of-type {
            margin-top: 0rem;
        }
        .class, .function, .data {
            margin-top: 5rem;
            margin-bottom: 7rem;
            border-left: 1px solid #eee;
            padding-left: 1rem;
        }
        dl.attribute > dd, dl.class > dd, dl.function > dd, dl.method > dd {
            margin-left: 30px;
        }
        p {
            margin-top: 1.05em;
            margin-bottom: 1.05em;
            text-align: justify;
        }
        .field-list p, li p {
            text-align: left;
        }
        /* adjust font sizes */
        dl.field-list, dl.attribute {
            font-size: 90%;
        }
        .math {
            font-size: 90.09%;
        }
    </style>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="index.html">
          Prodigy</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://github.com/Philipp15b/probably">GitHub Repository</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="index.html">Contents <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">prodigy.pgcl</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#compiler-frontend">Compiler Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-prodigy.pgcl.parser.parser">Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variable-substitution">Variable Substitution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#control-flow-graph">Control-Flow Graph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pysmt.html"><code class="docutils literal notranslate"><span class="pre">prodigy.pysmt</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="pysmt.html#translation-context">Translation Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="pysmt.html#expression-translation">Expression Translation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html"><code class="docutils literal notranslate"><span class="pre">prodigy.analysis</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="analysis.html#forward-analysis">Forward Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#the-semantics">The Semantics</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#distribution">Distribution</a></li>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#analysis-configuration">Analysis Configuration</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#forward-analysis-config">Forward Analysis Config</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="analysis.html#module-prodigy.analysis.backward.wp">Backward Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="analysis.html#weakest-pre-expectations">Weakest Pre-Expectations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#loop-free">Loop-Free</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#transformers">Transformers</a></li>
<li class="toctree-l4"><a class="reference internal" href="analysis.html#loops">Loops</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="util.html"><code class="docutils literal notranslate"><span class="pre">prodigy.util</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="util.html#mutable-references">Mutable References</a></li>
<li class="toctree-l2"><a class="reference internal" href="util.html#lark-expression-parser">Lark Expression Parser</a></li>
</ul>
</li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary">
<h4 style="padding: 5px 20px">Contents</h4>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">prodigy.pgcl</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#compiler-frontend">Compiler Frontend</a></li>
<li class="toctree-l2"><a class="reference internal" href="#module-prodigy.pgcl.parser.parser">Parser</a></li>
<li class="toctree-l2"><a class="reference internal" href="#variable-substitution">Variable Substitution</a></li>
<li class="toctree-l2"><a class="reference internal" href="#control-flow-graph">Control-Flow Graph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="pysmt.html"><code class="docutils literal notranslate"><span class="pre">prodigy.pysmt</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html"><code class="docutils literal notranslate"><span class="pre">prodigy.analysis</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="util.html"><code class="docutils literal notranslate"><span class="pre">prodigy.util</span></code></a></li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <span class="target" id="module-prodigy.pgcl"></span><div class="section" id="prodigy-pgcl">
<h1><code class="docutils literal notranslate"><span class="pre">prodigy.pgcl</span></code><a class="headerlink" href="#prodigy-pgcl" title="Permalink to this headline">¶</a></h1>
<p>This module implements pGCL parsing, type-checking, and transformations of pGCL programs.
The most important modules are the two below:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#module-prodigy.pgcl.compiler" title="prodigy.pgcl.compiler"><code class="xref py py-mod docutils literal notranslate"><span class="pre">prodigy.pgcl.compiler</span></code></a>. Functions that do parsing and type-checking all at once.</p></li>
<li><p><a class="reference internal" href="#module-prodigy.pgcl.ast" title="prodigy.pgcl.ast"><code class="xref py py-mod docutils literal notranslate"><span class="pre">prodigy.pgcl.ast</span></code></a>. The abstract syntax tree (AST) with all its types that define it.</p></li>
</ol>
<p>It is also possible to calculate weakest pre-expectations of programs (see <code class="xref py py-mod docutils literal notranslate"><span class="pre">prodigy.pgcl.backward</span></code>) for some specific types of programs.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">prodigy.pgcl.compiler</span> <span class="kn">import</span> <span class="n">compile_pgcl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;# this is a comment</span>
<span class="gp">... </span><span class="s1"># A program starts with the variable declarations.</span>
<span class="gp">... </span><span class="s1"># Every variable must be declared.</span>
<span class="gp">... </span><span class="s1"># A variable is either of type nat or of type bool.</span>
<span class="gp">... </span><span class="s1">bool f;</span>
<span class="gp">... </span><span class="s1">nat c;  # optional: provide bounds for the variables. The declaration then looks as follows: nat c [0,100]</span>
<span class="gp">...</span><span class="s1"></span>
<span class="gp">... </span><span class="s1"># Logical operators: &amp; (and),  || (or), not (negation)</span>
<span class="gp">... </span><span class="s1"># Operator precedences: not &gt; &amp; &gt; ||</span>
<span class="gp">... </span><span class="s1"># Comparing arithmetic expressions: &lt;=, &lt;, ==</span>
<span class="gp">...</span><span class="s1"></span>
<span class="gp">... </span><span class="s1">skip;</span>
<span class="gp">...</span><span class="s1"></span>
<span class="gp">... </span><span class="s1">while (c &lt; 10 &amp; f) {</span>
<span class="gp">... </span><span class="s1">    {c := unif(1,10)} [0.8] {f:=true}</span>
<span class="gp">... </span><span class="s1">}&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">compile_pgcl</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
<span class="go">Program(variables={&#39;f&#39;: BoolType(), &#39;c&#39;: NatType(bounds=None)}, constants={}, instructions=[SkipInstr(), WhileInstr(cond=BinopExpr(operator=Binop.AND, lhs=BinopExpr(operator=Binop.LE, lhs=VarExpr(&#39;c&#39;), rhs=NatLitExpr(10)), rhs=VarExpr(&#39;f&#39;)), body=[ChoiceInstr(prob=RealLitExpr(&quot;0.8&quot;), lhs=[AsgnInstr(lhs=&#39;c&#39;, rhs=DUniformExpr(start=NatLitExpr(1), end=NatLitExpr(10)))], rhs=[AsgnInstr(lhs=&#39;f&#39;, rhs=BoolLitExpr(True))])])])</span>
</pre></div>
</div>
<p>For more details on what syntax is accepted for pGCL programs, you can view the <a class="reference internal" href="pgcl_grammar.html#pgcl-grammar"><span class="std std-ref">formal grammar used for the pGCL parser</span></a>.</p>
<span class="target" id="module-prodigy.pgcl.compiler"></span><div class="section" id="compiler-frontend">
<h2>Compiler Frontend<a class="headerlink" href="#compiler-frontend" title="Permalink to this headline">¶</a></h2>
<p>This module provides an API that combines parsing and type-checking all at once.
It is just a thin wrapper around the parser, type-checker, and constant substitution.</p>
<p>Refer to <a class="reference internal" href="#module-prodigy.pgcl.parser" title="prodigy.pgcl.parser"><code class="xref py py-mod docutils literal notranslate"><span class="pre">prodigy.pgcl.parser</span></code></a> and <code class="xref py py-mod docutils literal notranslate"><span class="pre">prodigy.pgcl.check</span></code> for the parser and type-checker respectively.
Variable/constant substituion is implemented in <a class="reference internal" href="#module-prodigy.pgcl.substitute" title="prodigy.pgcl.substitute"><code class="xref py py-mod docutils literal notranslate"><span class="pre">prodigy.pgcl.substitute</span></code></a>.
If you want them, linearity checks live in <code class="xref py py-mod docutils literal notranslate"><span class="pre">prodigy.pgcl.syntax</span></code>.</p>
<dl class="py function">
<dt id="prodigy.pgcl.compiler.compile_pgcl">
<code class="sig-name descname"><span class="pre">compile_pgcl</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">substitute_constants</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/compiler.html#compile_pgcl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.compiler.compile_pgcl" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse and type-check a pGCL program.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">compile_pgcl</span><span class="p">(</span><span class="s2">&quot;nat x; nat y; x := y&quot;</span><span class="p">)</span>
<span class="go">Program(variables={&#39;x&#39;: NatType(bounds=None), &#39;y&#39;: NatType(bounds=None)}, constants={}, instructions=[AsgnInstr(lhs=&#39;x&#39;, rhs=VarExpr(&#39;y&#39;))])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">compile_pgcl</span><span class="p">(</span><span class="s2">&quot;x := y&quot;</span><span class="p">)</span>
<span class="go">CheckFail(location=..., message=&#39;x is not a variable.&#39;)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>code</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – </p></li>
<li><p><strong>substitute_constants</strong> – Whether constant substitution is done on the program, defaults to <cite>True</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">Program</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CheckFail</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="prodigy.pgcl.compiler.compile_expr">
<code class="sig-name descname"><span class="pre">compile_expr</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">program</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">substitute_constants</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/compiler.html#compile_expr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.compiler.compile_expr" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse and type-check an expression.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>program</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Program</span></code>) – </p></li>
<li><p><strong>code</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – </p></li>
<li><p><strong>substitute_constants</strong> – Whether constant substitution is done on the expression, defaults to <cite>True</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">VarExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BoolLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">NatLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RealLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">UnopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BernoulliExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">GeometricExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PoissonExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LogDistExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinomialExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IidSampleExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CheckFail</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="prodigy.pgcl.compiler.compile_expectation">
<code class="sig-name descname"><span class="pre">compile_expectation</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">program</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">code</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">substitute_constants</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/compiler.html#compile_expectation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.compiler.compile_expectation" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse and type-check an expectation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>program</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Program</span></code>) – </p></li>
<li><p><strong>code</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – </p></li>
<li><p><strong>substitute_constants</strong> – Whether constant substitution is done on the expectation, defaults to <cite>True</cite>.</p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">VarExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BoolLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">NatLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RealLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">UnopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BernoulliExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">GeometricExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PoissonExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LogDistExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinomialExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IidSampleExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CheckFail</span></code>]</p>
</dd>
</dl>
</dd></dl>

</div>
<span class="target" id="module-prodigy.pgcl.ast"></span><span class="target" id="module-prodigy.pgcl.analyzer"></span><span class="target" id="module-prodigy.pgcl.parser"></span><div class="section" id="module-prodigy.pgcl.parser.parser">
<span id="parser"></span><h2>Parser<a class="headerlink" href="#module-prodigy.pgcl.parser.parser" title="Permalink to this headline">¶</a></h2>
<p>A Lark-based parser for pGCL.</p>
<p>For more details on what syntax is accepted for pGCL programs, you can view the <a class="reference internal" href="pgcl_grammar.html#pgcl-grammar"><span class="std std-ref">formal grammar used for the parser</span></a>.</p>
<p class="rubric">Notes on the parsing algorithm</p>
<p>For most of the grammar, a simple run of the Lark parser suffices. The only
slightly tricky part is parsing of categorical choice expressions. To avoid
ambiguous grammar, we parse those as normal expressions of <cite>PLUS</cite> operators.
Individual weights attached to probabilities are saved in a temporary
<cite>LikelyExpr</cite> type which associates a single expression with a probability. Later
we collect all <cite>LikelyExpr</cite> and flatten them into a single
<code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalExpr</span></code>. <cite>LikelyExpr</cite> never occur outside of this parser.</p>
<dl class="py function">
<dt id="prodigy.pgcl.parser.parser.setup">
<code class="sig-name descname"><span class="pre">setup</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/parser/parser.html#setup"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.parser.parser.setup" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>filename</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Lark</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="prodigy.pgcl.parser.parser.parse_pgcl">
<code class="sig-name descname"><span class="pre">parse_pgcl</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">ProgramConfig(allow_real_vars=True)</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/parser/parser.html#parse_pgcl"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.parser.parser.parse_pgcl" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse a pGCL program with an optional <code class="xref py py-class docutils literal notranslate"><span class="pre">prodigy.pgcl.ast.ProgramConfig</span></code>.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse_pgcl</span><span class="p">(</span><span class="s2">&quot;x := y&quot;</span><span class="p">)</span>
<span class="go">Program(variables={}, constants={}, instructions=[AsgnInstr(lhs=&#39;x&#39;, rhs=VarExpr(&#39;y&#39;))])</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">parse_pgcl</span><span class="p">(</span><span class="s2">&quot;x := unif(5, 17)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">AsgnInstr(lhs=&#39;x&#39;, rhs=DUniformExpr(start=NatLitExpr(5), end=NatLitExpr(17)))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">parse_pgcl</span><span class="p">(</span><span class="s2">&quot;x := x : 1/3 + y : 2/3&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">instructions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="go">AsgnInstr(lhs=&#39;x&#39;, rhs=CategoricalExpr(exprs=[(VarExpr(&#39;x&#39;), RealLitExpr(&quot;1/3&quot;)), (VarExpr(&#39;y&#39;), RealLitExpr(&quot;2/3&quot;))]))</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>code</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – </p></li>
<li><p><strong>config</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">ProgramConfig</span></code>) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Program</span></code></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="prodigy.pgcl.parser.parser.parse_expr">
<code class="sig-name descname"><span class="pre">parse_expr</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/parser/parser.html#parse_expr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.parser.parser.parse_expr" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse a pGCL expression.</p>
<p>As a program expression, it may not contain Iverson bracket expressions.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse_expr</span><span class="p">(</span><span class="s2">&quot;x &lt; y &amp; z&quot;</span><span class="p">)</span>
<span class="go">BinopExpr(operator=Binop.AND, lhs=BinopExpr(operator=Binop.LE, lhs=VarExpr(&#39;x&#39;), rhs=VarExpr(&#39;y&#39;)), rhs=VarExpr(&#39;z&#39;))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">parse_expr</span><span class="p">(</span><span class="s2">&quot;[x]&quot;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">Exception</span>: <span class="n">parse_expr: Expression may not contain an Iverson bracket expression.</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>code</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">VarExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BoolLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">NatLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RealLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">UnopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BernoulliExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">GeometricExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PoissonExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LogDistExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinomialExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IidSampleExpr</span></code>]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="prodigy.pgcl.parser.parser.parse_expectation">
<code class="sig-name descname"><span class="pre">parse_expectation</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">code</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/parser/parser.html#parse_expectation"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.parser.parser.parse_expectation" title="Permalink to this definition">¶</a></dt>
<dd><p>Parse a pGCL expectation. This allows all kind of expressions.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parse_expectation</span><span class="p">(</span><span class="s2">&quot;[x]&quot;</span><span class="p">)</span>
<span class="go">UnopExpr(operator=Unop.IVERSON, expr=VarExpr(&#39;x&#39;))</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">parse_expectation</span><span class="p">(</span><span class="s2">&quot;0.2&quot;</span><span class="p">)</span>
<span class="go">RealLitExpr(&quot;0.2&quot;)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">parse_expectation</span><span class="p">(</span><span class="s2">&quot;1/3&quot;</span><span class="p">)</span>
<span class="go">RealLitExpr(&quot;1/3&quot;)</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">parse_expectation</span><span class="p">(</span><span class="s2">&quot;∞&quot;</span><span class="p">)</span>
<span class="go">RealLitExpr(&quot;Infinity&quot;)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>code</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">VarExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BoolLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">NatLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RealLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">UnopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BernoulliExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">GeometricExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PoissonExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LogDistExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinomialExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IidSampleExpr</span></code>]</p>
</dd>
</dl>
</dd></dl>

</div>
<span class="target" id="module-prodigy.pgcl.typechecker"></span><span class="target" id="module-prodigy.pgcl.substitute"></span><div class="section" id="variable-substitution">
<h2>Variable Substitution<a class="headerlink" href="#variable-substitution" title="Permalink to this headline">¶</a></h2>
<p>This module does variable substitution for expressions, expectations, and programs.
The purpose of this module is elimination of <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code> by applying the corresponding substitutions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The program must be well-typed.
In particular, variables must be defined before they are used and substitutions must be type-safe.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The input AST <strong>must be a tree</strong> and objects may not occur multiple times. This is a limitation of the current implementation.
General DAGs are not supported yet.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><strong>Substitutions reuse AST objects</strong>, and do not copy unnecessarily.
Thus, AST objects may turn up multiple times in the AST.
For later mutation of the AST, you may want to pass <cite>deepcopy = True</cite> to prevent spooky action action at a distance.</p>
</div>
<p class="rubric" id="substitute-symbolic-variables">Symbolic variables</p>
<p>Each substitution function takes a parameter <cite>symbolic</cite> parameter that is a set of variables to be taken symbolic.
Symbolic variables are placeholders for arbitrary expressions, and thus it is not known which variables they contain.
Therefore the substitution cannot be done at this time.
Instead, a substitution applied to a symbolic variable will wrap the variable in a <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code> that contains all substitutions applied to this variable.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">prodigy.util.ref</span> <span class="kn">import</span> <span class="n">Mut</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">.ast</span> <span class="kn">import</span> <span class="n">SubstExpr</span><span class="p">,</span> <span class="n">NatLitExpr</span><span class="p">,</span> <span class="n">VarExpr</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">.parser</span> <span class="kn">import</span> <span class="n">parse_expr</span>

<span class="go">Simple substitution without symbolic variables:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr_ref</span> <span class="o">=</span> <span class="n">Mut</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">SubstExpr</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">NatLitExpr</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span> <span class="n">parse_expr</span><span class="p">(</span><span class="s2">&quot;x + y&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">substitute_expr</span><span class="p">(</span><span class="n">expr_ref</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">expr_ref</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="go">&#39;2 + y&#39;</span>

<span class="go">The same substitution with `y` being symbolic:</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">expr_ref</span> <span class="o">=</span> <span class="n">Mut</span><span class="o">.</span><span class="n">alloc</span><span class="p">(</span><span class="n">SubstExpr</span><span class="p">({</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">NatLitExpr</span><span class="p">(</span><span class="mi">2</span><span class="p">)},</span> <span class="n">parse_expr</span><span class="p">(</span><span class="s2">&quot;x + y&quot;</span><span class="p">)))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">substitute_expr</span><span class="p">(</span><span class="n">expr_ref</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">str</span><span class="p">(</span><span class="n">expr_ref</span><span class="o">.</span><span class="n">val</span><span class="p">)</span>
<span class="go">&#39;2 + ((y)[x/2])&#39;</span>
</pre></div>
</div>
<p class="rubric">Implementation notes</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="substitute_internals.html">Documentation of internal classes and functions</a> can be found on another page.</p>
</div>
<p>The implementation is much more sophisticated than the simple approach of doubly-recursive bottom-up substition application.
For comparison, the simple approach is available in <cite>tests/test_substitution.py</cite> and used to test this implementation.
In this module, we implement a different approach using generated local variables for each substitution.</p>
<p>First the <cite>binding</cite> phase, top-down (implemented in <a class="reference internal" href="substitute_internals.html#prodigy.pgcl.substitute._Binder.bind" title="prodigy.pgcl.substitute._Binder.bind"><code class="xref py py-func docutils literal notranslate"><span class="pre">_Binder.bind()</span></code></a>):</p>
<ol class="arabic simple">
<li><p>For each substitution expression and each substitution <cite>x/y</cite>, generate a new local variable <cite>t</cite>.</p></li>
<li><p>Run all current substitutions on <cite>y</cite>, generating <cite>y’</cite>.</p></li>
<li><p>Now remember two substitutions: <cite>x/t</cite> and <cite>t/y’</cite>.</p></li>
<li><p>Recurse into the substitutions’ children.</p></li>
</ol>
<p>Then the <cite>resolve</cite> phase (direction is irrelevant, implemented in <a class="reference internal" href="substitute_internals.html#prodigy.pgcl.substitute._Binder.resolve" title="prodigy.pgcl.substitute._Binder.resolve"><code class="xref py py-func docutils literal notranslate"><span class="pre">_Binder.resolve()</span></code></a>):</p>
<ol class="arabic simple">
<li><p>On the generated substitutions for local variables, replace all simple ones of the form <cite>t1/t2</cite>, resolving <cite>t2</cite> recursively. Now the object references to be inserted in the AST are final (not necessarily nested objects).</p></li>
<li><p>Now we update the objects to be inserted in the AST, i.e. all replacements of the form <cite>t1/r</cite> for general expressions <cite>r</cite> are updated by replacing all locals <cite>t_i</cite> occuring in <cite>r</cite>. All substitutions are now final.</p></li>
<li><p>Replace all locals in the expression itself.</p></li>
</ol>
<p>Except for step 1 of the <cite>resolve</cite> phase, all phases clearly take linear time.
Step 1 of <cite>resolve</cite> is only run for simple chains of substitutions with no nested locals (e.g. generated from <code class="docutils literal notranslate"><span class="pre">x[x/y][y/z]</span></code>), and the step also amortizes lookups.
So basically we have linear runtime.</p>
<p>This implementation was very loosely inspired by an article <a class="footnote-reference brackets" href="#locallynameless" id="id1">4</a> on “locally nameless” substitution based on the awesomely titled paper “I am not a Number — I am a Free Variable” <a class="footnote-reference brackets" href="#haskell2004" id="id2">5</a>.</p>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="locallynameless"><span class="brackets"><a class="fn-backref" href="#id1">4</a></span></dt>
<dd><p><a class="reference external" href="https://boarders.github.io/posts/locally-nameless/">https://boarders.github.io/posts/locally-nameless/</a></p>
</dd>
<dt class="label" id="haskell2004"><span class="brackets"><a class="fn-backref" href="#id2">5</a></span></dt>
<dd><p>“I am not a number: I am a free variable” (2004) by McBride and McKinna.</p>
</dd>
</dl>
<dl class="py function">
<dt id="prodigy.pgcl.substitute.substitute_expr">
<code class="sig-name descname"><span class="pre">substitute_expr</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr_ref</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbolic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deepcopy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/substitute.html#substitute_expr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.substitute.substitute_expr" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply substitutions in this expression/expectation.
After execution, the <cite>expr_ref</cite> contains no <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code> anywhere except directly around <cite>symbolic</cite> variables.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>expr_ref</strong> (<a class="reference internal" href="util.html#prodigy.util.ref.Mut" title="prodigy.util.ref.Mut"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mut</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">VarExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BoolLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">NatLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RealLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">UnopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BernoulliExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">GeometricExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PoissonExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LogDistExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinomialExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IidSampleExpr</span></code>]]) – The reference to the expression to be modified.</p></li>
<li><p><strong>symbolic</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.FrozenSet" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrozenSet</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]]) – The set of symbolic variables. See the module description.</p></li>
<li><p><strong>deepcopy</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a>) – Whether to call <cite>deepcopy</cite> on each replacement, i.e. not reuse any AST objects in substitutions.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="prodigy.pgcl.substitute.substitute_constants_expr">
<code class="sig-name descname"><span class="pre">substitute_constants_expr</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">program</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expr_ref</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbolic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/substitute.html#substitute_constants_expr"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.substitute.substitute_constants_expr" title="Permalink to this definition">¶</a></dt>
<dd><p>Substitute constants in this expression/expectation.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>program</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Program</span></code>) – The program with variable declarations.</p></li>
<li><p><strong>expr_ref</strong> (<a class="reference internal" href="util.html#prodigy.util.ref.Mut" title="prodigy.util.ref.Mut"><code class="xref py py-class docutils literal notranslate"><span class="pre">Mut</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">VarExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BoolLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">NatLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RealLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">UnopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BernoulliExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">GeometricExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PoissonExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LogDistExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinomialExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IidSampleExpr</span></code>]]) – The reference to the expression to be modified.</p></li>
<li><p><strong>symbolic</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.FrozenSet" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrozenSet</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]]) – The set of symbolic variables. See the module description.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="prodigy.pgcl.substitute.substitute_constants">
<code class="sig-name descname"><span class="pre">substitute_constants</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">program</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">symbolic</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/substitute.html#substitute_constants"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.substitute.substitute_constants" title="Permalink to this definition">¶</a></dt>
<dd><p>Substitute constants in this program.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">prodigy.pgcl.parser</span> <span class="kn">import</span> <span class="n">parse_pgcl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">program</span> <span class="o">=</span> <span class="n">parse_pgcl</span><span class="p">(</span><span class="s2">&quot;const x := 23; nat y; nat z; y := x; z := y&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">substitute_constants</span><span class="p">(</span><span class="n">program</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">program</span><span class="o">.</span><span class="n">instructions</span>
<span class="go">[AsgnInstr(lhs=&#39;y&#39;, rhs=NatLitExpr(23)), AsgnInstr(lhs=&#39;z&#39;, rhs=VarExpr(&#39;y&#39;))]</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>program</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Program</span></code>) – The program to be modified.</p></li>
<li><p><strong>symbolic</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.FrozenSet" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">FrozenSet</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>]]) – The set of symbolic variables. See the module description.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</div>
<span class="target" id="module-prodigy.pgcl.cfg"></span><div class="section" id="control-flow-graph">
<h2>Control-Flow Graph<a class="headerlink" href="#control-flow-graph" title="Permalink to this headline">¶</a></h2>
<p>This module can build up <em>control-flow graphs</em> (CFGs) of pGCL programs and
<em>decompile</em> them back to programs again. The main purpose of this module is the
transformation of a program with arbitrarily nested loops into a program with
one big loop (<a class="reference internal" href="#prodigy.pgcl.cfg.program_one_big_loop" title="prodigy.pgcl.cfg.program_one_big_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">program_one_big_loop()</span></code></a>).</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">prodigy.pgcl.compiler</span> <span class="kn">import</span> <span class="n">compile_pgcl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">program</span> <span class="o">=</span> <span class="n">compile_pgcl</span><span class="p">(</span><span class="s2">&quot;nat x; while (x &lt;= 3) { while (x = 0) { x := x + 1; }; if (x = 0) { x := x + 1; x := x + 2; x := x + 3; } </span><span class="si">{}</span><span class="s2"> }&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">graph</span> <span class="o">=</span> <span class="n">ControlFlowGraph</span><span class="o">.</span><span class="n">from_instructions</span><span class="p">(</span><span class="n">program</span><span class="o">.</span><span class="n">instructions</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">graph</span><span class="o">.</span><span class="n">render_dot</span><span class="p">()</span><span class="o">.</span><span class="n">source</span>
<span class="go">&#39;digraph...&#39;</span>
</pre></div>
</div>
<p>You can see the control-flow graph for this program visualized using GraphViz
below. It was created with the <a class="reference internal" href="#prodigy.pgcl.cfg.ControlFlowGraph.render_dot" title="prodigy.pgcl.cfg.ControlFlowGraph.render_dot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ControlFlowGraph.render_dot()</span></code></a> method. See
its documentation for more information on how to visualize a control-flow graph.</p>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>Unable to execute python code at cfg.py:docstring of prodigy.pgcl.cfg:26:</p>
<p>failed to execute [‘dot’, ‘-Tsvg’, ‘-O’, ‘cfg’], make sure the Graphviz executables are on your systems’ PATH</p>
</div>
<img alt="_generated/cfg.svg" class="align-center" src="_generated/cfg.svg" /><dl class="py class">
<dt id="prodigy.pgcl.cfg.TerminatorKind">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">TerminatorKind</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#TerminatorKind"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.TerminatorKind" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether the <a class="reference internal" href="#prodigy.pgcl.cfg.Terminator" title="prodigy.pgcl.cfg.Terminator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Terminator</span></code></a> branches on a Boolean condition or throws a
die with a probability given by an expression.</p>
<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.TerminatorKind.BOOLEAN">
<code class="sig-name descname"><span class="pre">BOOLEAN</span></code><em class="property"> <span class="pre">=</span> <span class="pre">1</span></em><a class="headerlink" href="#prodigy.pgcl.cfg.TerminatorKind.BOOLEAN" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.TerminatorKind.PROBABILISTIC">
<code class="sig-name descname"><span class="pre">PROBABILISTIC</span></code><em class="property"> <span class="pre">=</span> <span class="pre">2</span></em><a class="headerlink" href="#prodigy.pgcl.cfg.TerminatorKind.PROBABILISTIC" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="prodigy.pgcl.cfg.Terminator">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">Terminator</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">kind</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">condition</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">if_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">if_false</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#Terminator"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#prodigy.pgcl.cfg.BasicBlock" title="prodigy.pgcl.cfg.BasicBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicBlock</span></code></a> is terminated by a <em>terminator</em>, which says where to
go next after executing all assignment statements.</p>
<p>If a successor block id is <cite>None</cite>, it indicates program termination.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>kind</strong> (<a class="reference internal" href="#prodigy.pgcl.cfg.TerminatorKind" title="prodigy.pgcl.cfg.TerminatorKind"><code class="xref py py-class docutils literal notranslate"><span class="pre">TerminatorKind</span></code></a>) – </p></li>
<li><p><strong>condition</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">VarExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BoolLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">NatLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RealLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">UnopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BernoulliExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">GeometricExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PoissonExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LogDistExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinomialExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IidSampleExpr</span></code>]) – </p></li>
<li><p><strong>if_true</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]) – </p></li>
<li><p><strong>if_false</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]) – </p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.Terminator.LEAF">
<code class="sig-name descname"><span class="pre">LEAF</span></code><em class="property"><span class="pre">:</span> <a class="reference internal" href="#prodigy.pgcl.cfg.Terminator" title="prodigy.pgcl.cfg.Terminator"><span class="pre">prodigy.pgcl.cfg.Terminator</span></a></em><em class="property"> <span class="pre">=</span> <span class="pre">Terminator(kind=&lt;TerminatorKind.BOOLEAN:</span> <span class="pre">1&gt;,</span> <span class="pre">condition=BoolLitExpr(True),</span> <span class="pre">if_true=None,</span> <span class="pre">if_false=None)</span></em><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.LEAF" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.Terminator.goto">
<em class="property"><span class="pre">static</span> </em><code class="sig-name descname"><span class="pre">goto</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ident</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#Terminator.goto"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.goto" title="Permalink to this definition">¶</a></dt>
<dd><p>Always go to the given block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ident</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#prodigy.pgcl.cfg.Terminator" title="prodigy.pgcl.cfg.Terminator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Terminator</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.Terminator.branch">
<em class="property"><span class="pre">static</span> </em><code class="sig-name descname"><span class="pre">branch</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cond</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">if_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">if_false</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#Terminator.branch"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.branch" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a Boolean branching terminator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>cond</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">VarExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BoolLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">NatLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RealLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">UnopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BernoulliExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">GeometricExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PoissonExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LogDistExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinomialExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IidSampleExpr</span></code>]) – </p></li>
<li><p><strong>if_true</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]) – </p></li>
<li><p><strong>if_false</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#prodigy.pgcl.cfg.Terminator" title="prodigy.pgcl.cfg.Terminator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Terminator</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.Terminator.choice">
<em class="property"><span class="pre">static</span> </em><code class="sig-name descname"><span class="pre">choice</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">expr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lhs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rhs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#Terminator.choice"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.choice" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct a probabilistic choice terminator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>expr</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">VarExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BoolLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">NatLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RealLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">UnopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BernoulliExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">GeometricExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PoissonExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LogDistExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinomialExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IidSampleExpr</span></code>]) – </p></li>
<li><p><strong>lhs</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]) – </p></li>
<li><p><strong>rhs</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]) – </p></li>
</ul>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#prodigy.pgcl.cfg.Terminator" title="prodigy.pgcl.cfg.Terminator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Terminator</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.Terminator.kind">
<code class="sig-name descname"><span class="pre">kind</span></code><em class="property"><span class="pre">:</span> <a class="reference internal" href="#prodigy.pgcl.cfg.TerminatorKind" title="prodigy.pgcl.cfg.TerminatorKind"><span class="pre">prodigy.pgcl.cfg.TerminatorKind</span></a></em><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.kind" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.Terminator.condition">
<code class="sig-name descname"><span class="pre">condition</span></code><em class="property"><span class="pre">:</span> <span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">prodigy.pgcl.ast.expressions.VarExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.BoolLitExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.NatLitExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.RealLitExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.UnopExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.BinopExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.CategoricalExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.SubstExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.TickExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.DUniformExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.CUniformExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.BernoulliExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.GeometricExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.PoissonExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.LogDistExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.BinomialExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.IidSampleExpr</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.condition" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.Terminator.if_true">
<code class="sig-name descname"><span class="pre">if_true</span></code><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">BasicBlockId</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.if_true" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.Terminator.if_false">
<code class="sig-name descname"><span class="pre">if_false</span></code><em class="property"><span class="pre">:</span> <span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">BasicBlockId</span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.if_false" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.Terminator.successors">
<em class="property"><span class="pre">property</span> </em><code class="sig-name descname"><span class="pre">successors</span></code><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.successors" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of successors of terminator.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.Terminator.is_goto">
<code class="sig-name descname"><span class="pre">is_goto</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#Terminator.is_goto"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.is_goto" title="Permalink to this definition">¶</a></dt>
<dd><p>Whether the condition is constant <cite>True</cite> or both successors are the
same.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.Terminator.substitute">
<code class="sig-name descname"><span class="pre">substitute</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">subst</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#Terminator.substitute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.substitute" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply the substitution to this terminator’s successors.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>subst</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]]) – </p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.Terminator.flip">
<code class="sig-name descname"><span class="pre">flip</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#Terminator.flip"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.Terminator.flip" title="Permalink to this definition">¶</a></dt>
<dd><p>Flip the condition (by negation using
<code class="xref py py-func docutils literal notranslate"><span class="pre">prodigy.pgcl.simplify.simplifying_neg()</span></code>) and switch both branches
of this terminator. The operation does not change the semantics of the
terminator.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="prodigy.pgcl.cfg.BlockType">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">BlockType</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#BlockType"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.BlockType" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference internal" href="#prodigy.pgcl.cfg.BasicBlock" title="prodigy.pgcl.cfg.BasicBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicBlock</span></code></a> has an attached marker type that is used for
back-conversion from a control-flow graph to a structured program, for
pretty-printing the graph, and for debugging.</p>
<p>All successor branches of <cite>forward</cite> blocks eventually converge on the same
block. These are created from any statement except loops. <cite>Loop head</cite> nodes
are the basic blocks created for the loop condition. These are the first
entry into a loop from the program start. <cite>Trampoline</cite> blocks are created by
the <a class="reference internal" href="#prodigy.pgcl.cfg.one_big_loop" title="prodigy.pgcl.cfg.one_big_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">one_big_loop()</span></code></a> transformation only.</p>
<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.BlockType.FORWARD">
<code class="sig-name descname"><span class="pre">FORWARD</span></code><em class="property"> <span class="pre">=</span> <span class="pre">1</span></em><a class="headerlink" href="#prodigy.pgcl.cfg.BlockType.FORWARD" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.BlockType.LOOP_HEAD">
<code class="sig-name descname"><span class="pre">LOOP_HEAD</span></code><em class="property"> <span class="pre">=</span> <span class="pre">2</span></em><a class="headerlink" href="#prodigy.pgcl.cfg.BlockType.LOOP_HEAD" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.BlockType.TRAMPOLINE">
<code class="sig-name descname"><span class="pre">TRAMPOLINE</span></code><em class="property"> <span class="pre">=</span> <span class="pre">3</span></em><a class="headerlink" href="#prodigy.pgcl.cfg.BlockType.TRAMPOLINE" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt id="prodigy.pgcl.cfg.BasicBlock">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">BasicBlock</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">typ</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ident</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">assignments</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">terminator</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#BasicBlock"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.BasicBlock" title="Permalink to this definition">¶</a></dt>
<dd><p>A <em>basic block</em> in the control-flow graph consists of a series of
(unconditional) assignments that are executed in sequence, followed by a
<a class="reference internal" href="#prodigy.pgcl.cfg.Terminator" title="prodigy.pgcl.cfg.Terminator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Terminator</span></code></a> that says where to go next (based on some condition).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>typ</strong> (<a class="reference internal" href="#prodigy.pgcl.cfg.BlockType" title="prodigy.pgcl.cfg.BlockType"><code class="xref py py-class docutils literal notranslate"><span class="pre">BlockType</span></code></a>) – </p></li>
<li><p><strong>ident</strong> (<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)) – </p></li>
<li><p><strong>assignments</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Tuple</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>, <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">VarExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BoolLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">NatLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RealLitExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">UnopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinopExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CategoricalExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">SubstExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">DUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">CUniformExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BernoulliExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">GeometricExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PoissonExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LogDistExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">BinomialExpr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IidSampleExpr</span></code>]]]) – </p></li>
<li><p><strong>terminator</strong> (<a class="reference internal" href="#prodigy.pgcl.cfg.Terminator" title="prodigy.pgcl.cfg.Terminator"><code class="xref py py-class docutils literal notranslate"><span class="pre">Terminator</span></code></a>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.BasicBlock.typ">
<code class="sig-name descname"><span class="pre">typ</span></code><em class="property"><span class="pre">:</span> <a class="reference internal" href="#prodigy.pgcl.cfg.BlockType" title="prodigy.pgcl.cfg.BlockType"><span class="pre">prodigy.pgcl.cfg.BlockType</span></a></em><a class="headerlink" href="#prodigy.pgcl.cfg.BasicBlock.typ" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.BasicBlock.ident">
<code class="sig-name descname"><span class="pre">ident</span></code><em class="property"><span class="pre">:</span> <span class="pre">BasicBlockId</span></em><a class="headerlink" href="#prodigy.pgcl.cfg.BasicBlock.ident" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.BasicBlock.assignments">
<code class="sig-name descname"><span class="pre">assignments</span></code><em class="property"><span class="pre">:</span> <span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><span class="pre">str</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">prodigy.pgcl.ast.expressions.VarExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.BoolLitExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.NatLitExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.RealLitExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.UnopExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.BinopExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.CategoricalExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.SubstExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.TickExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.DUniformExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.CUniformExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.BernoulliExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.GeometricExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.PoissonExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.LogDistExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.BinomialExpr</span><span class="p"><span class="pre">,</span> </span><span class="pre">prodigy.pgcl.ast.expressions.IidSampleExpr</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></em><a class="headerlink" href="#prodigy.pgcl.cfg.BasicBlock.assignments" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.BasicBlock.terminator">
<code class="sig-name descname"><span class="pre">terminator</span></code><em class="property"><span class="pre">:</span> <a class="reference internal" href="#prodigy.pgcl.cfg.Terminator" title="prodigy.pgcl.cfg.Terminator"><span class="pre">prodigy.pgcl.cfg.Terminator</span></a></em><a class="headerlink" href="#prodigy.pgcl.cfg.BasicBlock.terminator" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.BasicBlock.is_trap">
<code class="sig-name descname"><span class="pre">is_trap</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#BasicBlock.is_trap"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.BasicBlock.is_trap" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">bool</span></code></a></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="prodigy.pgcl.cfg.ControlFlowGraph">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">ControlFlowGraph</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">entry_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">basic_blocks</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#ControlFlowGraph"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.ControlFlowGraph" title="Permalink to this definition">¶</a></dt>
<dd><p>The control-flow graph consists of an indexed list of <a class="reference internal" href="#prodigy.pgcl.cfg.BasicBlock" title="prodigy.pgcl.cfg.BasicBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicBlock</span></code></a>.</p>
<p>The <a class="reference internal" href="#prodigy.pgcl.cfg.ControlFlowGraph.render_dot" title="prodigy.pgcl.cfg.ControlFlowGraph.render_dot"><code class="xref py py-meth docutils literal notranslate"><span class="pre">render_dot()</span></code></a> and <a class="reference internal" href="#prodigy.pgcl.cfg.ControlFlowGraph.to_networkx" title="prodigy.pgcl.cfg.ControlFlowGraph.to_networkx"><code class="xref py py-meth docutils literal notranslate"><span class="pre">to_networkx()</span></code></a> methods can be very useful
for debugging and visualization of control-flow graphs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>entry_id</strong> (<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)) – </p></li>
<li><p><strong>basic_blocks</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a>[<a class="reference internal" href="#prodigy.pgcl.cfg.BasicBlock" title="prodigy.pgcl.cfg.BasicBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicBlock</span></code></a>]) – </p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt id="prodigy.pgcl.cfg.ControlFlowGraph.from_instructions">
<em class="property"><span class="pre">static</span> </em><code class="sig-name descname"><span class="pre">from_instructions</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">instructions</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#ControlFlowGraph.from_instructions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.ControlFlowGraph.from_instructions" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert the given list of instructions to the corresponding control-flow
graph. The successor of the final generated basic blocks is set to <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
<p>If the list of instructions is empty, a graph with a single basic block
will be returned.</p>
<div class="highlight-pycon3 notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">graph</span> <span class="o">=</span> <span class="n">ControlFlowGraph</span><span class="o">.</span><span class="n">from_instructions</span><span class="p">([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">graph</span><span class="p">)</span>
<span class="go">[BasicBlock(typ=..., ident=0, assignments=[], terminator=Terminator(kind=..., condition=BoolLitExpr(True), if_true=None, if_false=None))]</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>instructions</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">SkipInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">WhileInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IfInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">AsgnInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ChoiceInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LoopInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ObserveInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ProbabilityQueryInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ExpectationInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PlotInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PrintInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">OptimizationQuery</span></code>]]) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference internal" href="#prodigy.pgcl.cfg.ControlFlowGraph" title="prodigy.pgcl.cfg.ControlFlowGraph"><code class="xref py py-class docutils literal notranslate"><span class="pre">ControlFlowGraph</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.ControlFlowGraph.entry_id">
<code class="sig-name descname"><span class="pre">entry_id</span></code><em class="property"><span class="pre">:</span> <span class="pre">BasicBlockId</span></em><a class="headerlink" href="#prodigy.pgcl.cfg.ControlFlowGraph.entry_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.ControlFlowGraph.fresh_block">
<code class="sig-name descname"><span class="pre">fresh_block</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#ControlFlowGraph.fresh_block"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.ControlFlowGraph.fresh_block" title="Permalink to this definition">¶</a></dt>
<dd><p>Add a new, empty basic block to the graph of type <cite>forward</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference internal" href="#prodigy.pgcl.cfg.BasicBlock" title="prodigy.pgcl.cfg.BasicBlock"><code class="xref py py-class docutils literal notranslate"><span class="pre">BasicBlock</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.ControlFlowGraph.substitute">
<code class="sig-name descname"><span class="pre">substitute</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">subst</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blocks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#ControlFlowGraph.substitute"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.ControlFlowGraph.substitute" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply the substitutions to all blocks in <cite>blocks</cite> (or all blocks if
<cite>blocks</cite> is <cite>None</cite>).</p>
<p>Throws an exception if the entry point is replaced with <cite>None</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>subst</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Dict</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)], <a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]]) – </p></li>
<li><p><strong>blocks</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Set" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Set</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]]) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.ControlFlowGraph.to_networkx">
<code class="sig-name descname"><span class="pre">to_networkx</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#ControlFlowGraph.to_networkx"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.ControlFlowGraph.to_networkx" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a NetworkX <a class="reference external" href="https://networkx.org/documentation/stable/reference/classes/digraph.html#networkx.DiGraph" title="(in NetworkX v2.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">networkx.DiGraph</span></code></a> from this control-flow
graph for further analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><a class="reference external" href="https://networkx.org/documentation/stable/reference/classes/digraph.html#networkx.DiGraph" title="(in NetworkX v2.8)"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiGraph</span></code></a></p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.ControlFlowGraph.render_dot">
<code class="sig-name descname"><span class="pre">render_dot</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#ControlFlowGraph.render_dot"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.ControlFlowGraph.render_dot" title="Permalink to this definition">¶</a></dt>
<dd><p>Render this control-flow graph as a GraphViz
<a class="reference external" href="https://graphviz.readthedocs.io/en/stable/api.html#graphviz.Digraph" title="(in graphviz v0.20)"><code class="xref py py-class docutils literal notranslate"><span class="pre">graphviz.Digraph</span></code></a>.</p>
<p>The result can be written into a file using
<a class="reference external" href="https://graphviz.readthedocs.io/en/stable/api.html#graphviz.Digraph.render" title="(in graphviz v0.20)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">graphviz.Digraph.render()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="o">.</span><span class="n">render_dot</span><span class="p">()</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;graph.svg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://graphviz.readthedocs.io/en/stable/api.html#graphviz.Digraph.view" title="(in graphviz v0.20)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">graphviz.Digraph.view()</span></code></a> method can be used to quickly view
a graph:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span><span class="o">.</span><span class="n">render_dot</span><span class="p">()</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;graph.svg&#39;</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Digraph</span></code></p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt id="prodigy.pgcl.cfg.JumpTable">
<em class="property"><span class="pre">class</span> </em><code class="sig-name descname"><span class="pre">JumpTable</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">graph</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pc_var</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#JumpTable"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.JumpTable" title="Permalink to this definition">¶</a></dt>
<dd><p>To implement <a class="reference internal" href="#prodigy.pgcl.cfg.one_big_loop" title="prodigy.pgcl.cfg.one_big_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">one_big_loop()</span></code></a>, we cannot allow non-local gotos. Instead,
we build a jump table that branches on a variable.</p>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>Unable to execute python code at cfg.py:docstring of prodigy.pgcl.cfg.JumpTable:360:</p>
<p>failed to execute [‘dot’, ‘-Tsvg’, ‘-O’, ‘cfg-jumptable1’], make sure the Graphviz executables are on your systems’ PATH</p>
</div>
<p>Let’s look at a simple example. We start with two blocks: The <code class="docutils literal notranslate"><span class="pre">x</span> <span class="pre">:=</span> <span class="pre">42</span></code>
block (call it <cite>B1</cite>), and the <code class="docutils literal notranslate"><span class="pre">y</span> <span class="pre">:=</span> <span class="pre">11</span></code> block (call it <cite>B2</cite>).</p>
<a class="reference internal image-reference" href="_generated/cfg-jumptable1.svg"><img alt="_generated/cfg-jumptable1.svg" class="align-center" src="_generated/cfg-jumptable1.svg" width="330px" /></a>
<p>We’ll connect <cite>B1</cite> and <cite>B2</cite> with the jump table so that <cite>B2</cite> executes after
<cite>B1</cite>. We add one trampoline for <cite>B1</cite> and let <cite>start</cite> enter at that
trampoline. And then let <cite>B1</cite> continue to a new trampoline to <cite>B2</cite>. Note
that the generated jump table is linear in the number of branches. See
<a class="reference internal" href="#prodigy.pgcl.cfg.JumpTable.finalize" title="prodigy.pgcl.cfg.JumpTable.finalize"><code class="xref py py-meth docutils literal notranslate"><span class="pre">finalize()</span></code></a> as to why.</p>
<a class="reference internal image-reference" href="_generated/cfg-jumptable2.svg"><img alt="_generated/cfg-jumptable2.svg" class="align-center" src="_generated/cfg-jumptable2.svg" width="600px" /></a>
<p>The <code class="docutils literal notranslate"><span class="pre">goto</span> <span class="pre">3</span></code> block is unreachable and we write a self-loop basic block
that never exits to indicate that.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>graph</strong> (<a class="reference internal" href="#prodigy.pgcl.cfg.ControlFlowGraph" title="prodigy.pgcl.cfg.ControlFlowGraph"><code class="xref py py-class docutils literal notranslate"><span class="pre">ControlFlowGraph</span></code></a>) – </p></li>
<li><p><strong>pc_var</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – </p></li>
</ul>
</dd>
</dl>
<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.JumpTable.entry_id">
<code class="sig-name descname"><span class="pre">entry_id</span></code><em class="property"><span class="pre">:</span> <span class="pre">BasicBlockId</span></em><a class="headerlink" href="#prodigy.pgcl.cfg.JumpTable.entry_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="prodigy.pgcl.cfg.JumpTable.error_id">
<code class="sig-name descname"><span class="pre">error_id</span></code><em class="property"><span class="pre">:</span> <span class="pre">BasicBlockId</span></em><a class="headerlink" href="#prodigy.pgcl.cfg.JumpTable.error_id" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.JumpTable.trampoline">
<code class="sig-name descname"><span class="pre">trampoline</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">target</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#JumpTable.trampoline"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.JumpTable.trampoline" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the block id for a new trampoline that sets the program counter
appropiately and then jumps to the jump table entry basic block.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>target</strong> (<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Optional" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Optional</span></code></a>[<code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)]) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><code class="xref py py-func docutils literal notranslate"><span class="pre">NewType()</span></code>(<code class="xref py py-data docutils literal notranslate"><span class="pre">BasicBlockId</span></code>, <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="prodigy.pgcl.cfg.JumpTable.finalize">
<code class="sig-name descname"><span class="pre">finalize</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#JumpTable.finalize"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.JumpTable.finalize" title="Permalink to this definition">¶</a></dt>
<dd><p>Insert all jumps into the graph.</p>
<p>The generated jump table intentially only uses strict equality checks
against <cite>pc</cite>. While it is easily possible to generate a binary tree of
comparisons using <span class="math">\(\leq\)</span> (therefore logarithmic size in the number
of jumps), we decide against it. Inequalities make it harder to see
which conditions exclude each other and this makes debugging e.g.
weakest preexpectation generation (see <code class="xref py py-mod docutils literal notranslate"><span class="pre">prodigy.pgcl.backward</span></code>) a bit
harder.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt id="prodigy.pgcl.cfg.one_big_loop">
<code class="sig-name descname"><span class="pre">one_big_loop</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">graph</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pc_var</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#one_big_loop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.one_big_loop" title="Permalink to this definition">¶</a></dt>
<dd><p>Given a control-flow graph from a pGCL program with arbitrarily nested
loops, modify the graph in such a way that there is only one big loop that
branches to states of the loop. Use <code class="docutils literal notranslate"><span class="pre">pc_var</span></code> as the variable name for the
program counter variable <cite>pc</cite> in the generated jump table (it must not be
used elsewhere, but should be declared in the program already). For a CFG
from a well-structured pGCL program, the result is basically one big loop.</p>
<p>It is assumed all loop heads (see <a class="reference internal" href="#prodigy.pgcl.cfg.BlockType" title="prodigy.pgcl.cfg.BlockType"><code class="xref py py-class docutils literal notranslate"><span class="pre">BlockType</span></code></a>) are properly
annotated.</p>
<p>How does it work? This function basically just replaces each jump to a loop
header, and the program entry and exit with a trampoline
(<a class="reference internal" href="#prodigy.pgcl.cfg.JumpTable.trampoline" title="prodigy.pgcl.cfg.JumpTable.trampoline"><code class="xref py py-func docutils literal notranslate"><span class="pre">JumpTable.trampoline()</span></code></a>).</p>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>Unable to execute python code at cfg.py:docstring of prodigy.pgcl.cfg.one_big_loop:444:</p>
<p>failed to execute [‘dot’, ‘-Tsvg’, ‘-O’, ‘cfg-one-big-loop1’], make sure the Graphviz executables are on your systems’ PATH</p>
</div>
<p>Let’s work through a (contrived) example. The program below uses two nested
(but redundant) loops.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">bool</span> <span class="n">x</span><span class="p">;</span>
<span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">{</span> <span class="p">}</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span> <span class="p">{</span> <span class="n">x</span><span class="o">:=</span> <span class="n">false</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The resulting CFG is (from <a class="reference internal" href="#prodigy.pgcl.cfg.ControlFlowGraph.from_instructions" title="prodigy.pgcl.cfg.ControlFlowGraph.from_instructions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ControlFlowGraph.from_instructions()</span></code></a>):</p>
<a class="reference internal image-reference" href="_generated/cfg-one-big-loop1.svg"><img alt="_generated/cfg-one-big-loop1.svg" class="align-center" src="_generated/cfg-one-big-loop1.svg" width="500px" /></a>
<p>After <a class="reference internal" href="#prodigy.pgcl.cfg.one_big_loop" title="prodigy.pgcl.cfg.one_big_loop"><code class="xref py py-meth docutils literal notranslate"><span class="pre">one_big_loop()</span></code></a>, we get a much more complicated diagram (see
below). Now all loops go through the jump table basic blocks that branch on
<cite>pc</cite>.</p>
<a class="reference internal image-reference" href="_generated/cfg-one-big-loop2.svg"><img alt="_generated/cfg-one-big-loop2.svg" class="align-center" src="_generated/cfg-one-big-loop2.svg" width="100%" /></a>
<p>A subtlety can be found in the image above:  The first branch of the
generated jump table points to the program end and its terminator has been
flipped (<a class="reference internal" href="#prodigy.pgcl.cfg.Terminator.flip" title="prodigy.pgcl.cfg.Terminator.flip"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Terminator.flip()</span></code></a>) so that the <cite>true</cite> branch goes into the
loop and  and the <cite>false</cite> branch exits it. We do this to exactly reproduce
the shape of a generated <cite>while</cite> loop. Also note that the <code class="docutils literal notranslate"><span class="pre">goto</span> <span class="pre">5</span></code> is
unreachable. See <a class="reference internal" href="#prodigy.pgcl.cfg.JumpTable" title="prodigy.pgcl.cfg.JumpTable"><code class="xref py py-class docutils literal notranslate"><span class="pre">JumpTable</span></code></a> documentation for more information.</p>
<p>Unfortunately we cannot directly translate this control-flow graph back into
a well-structured pGCL program. By “direct translation” I mean translation
to a pGCL program while using each statement exactly once. Consider for
example the <code class="docutils literal notranslate"><span class="pre">pc</span> <span class="pre">:=</span> <span class="pre">1</span></code> basic block. It is obviously needed before the big
loop to enter the proper state, but it is also needed after the inner while
loop exits to return back to the outer loop (<code class="docutils literal notranslate"><span class="pre">br</span> <span class="pre">(x)</span> <span class="pre">2</span> <span class="pre">7</span></code>).
<a class="reference internal" href="#prodigy.pgcl.cfg.reduce_cfg_to_instrs" title="prodigy.pgcl.cfg.reduce_cfg_to_instrs"><code class="xref py py-func docutils literal notranslate"><span class="pre">reduce_cfg_to_instrs()</span></code></a> has extra functionality to handle this case and
will appropriately duplicate some trampoline blocks.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>graph</strong> (<a class="reference internal" href="#prodigy.pgcl.cfg.ControlFlowGraph" title="prodigy.pgcl.cfg.ControlFlowGraph"><code class="xref py py-class docutils literal notranslate"><span class="pre">ControlFlowGraph</span></code></a>) – </p></li>
<li><p><strong>pc_var</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="prodigy.pgcl.cfg.reduce_cfg_to_instrs">
<code class="sig-name descname"><span class="pre">reduce_cfg_to_instrs</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">graph</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#reduce_cfg_to_instrs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.reduce_cfg_to_instrs" title="Permalink to this definition">¶</a></dt>
<dd><p>Reduce a control-flow graph to a program (i.e. list of instructions). The
given graph must have the same shape as one generated by
<a class="reference internal" href="#prodigy.pgcl.cfg.ControlFlowGraph.from_instructions" title="prodigy.pgcl.cfg.ControlFlowGraph.from_instructions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ControlFlowGraph.from_instructions()</span></code></a>. This is the case for graphs
transformed by <a class="reference internal" href="#prodigy.pgcl.cfg.one_big_loop" title="prodigy.pgcl.cfg.one_big_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">one_big_loop()</span></code></a>.</p>
<p class="rubric">How Does It Work?</p>
<p>Recreating a structured program from a control-flow graph is a frighteningly
complex and not yet well studied problem. There is an ancient theorem called
<a class="reference external" href="https://en.wikipedia.org/wiki/Structured_program_theorem">Structured Program Theorem</a> that essentially states “flowcharts”
(basically the class of control-flow graphs we care about) can be reduced to
structured programs in a very simple way with pretty unreadable output.
It is listed under “folk version of the theorem”, generating a single while
loop <a class="footnote-reference brackets" href="#id10" id="id3">1</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pc</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">while</span> <span class="n">pc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">pc</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">block1</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">:=</span> <span class="n">successor</span> <span class="n">of</span> <span class="n">block</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">pc</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">block2</span><span class="p">()</span>
        <span class="n">pc</span> <span class="o">:=</span> <span class="n">successor</span> <span class="n">of</span> <span class="n">block</span> <span class="mi">2</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>This was <em>not</em> done here. Instead, we use a slightly smarter algorithm that
reconstructs hierarchical control structure using <a class="reference external" href="https://en.wikipedia.org/wiki/Dominator_(graph_theory)">Dominator trees</a>. Let’s
define some terms.</p>
<dl class="simple">
<dt>node <span class="math">\(d\)</span> dominates a node <span class="math">\(n\)</span></dt><dd><p>A node <span class="math">\(d\)</span> dominates a node <span class="math">\(n\)</span> if every path from the entry
node of the control-flow graph to <span class="math">\(n\)</span> must go through <cite>d</cite>. A node
<span class="math">\(d\)</span> <em>strictly</em> dominates a node <span class="math">\(n\)</span> if it dominates
<span class="math">\(n\)</span> and <span class="math">\(n \neq d\)</span>.</p>
</dd>
<dt>dominance frontier</dt><dd><p>The dominance frontier of a node <span class="math">\(d\)</span> is the set of all nodes
<span class="math">\(n\)</span> such that <span class="math">\(d\)</span> dominates an immediate predecessor of
<span class="math">\(n\)</span>, but does not strictly dominate <span class="math">\(n\)</span>.</p>
</dd>
<dt>region</dt><dd><p>A region is defined by an <em>entry edge</em> and <em>exit edge</em>, where the entry
edge dominates the exit edge, the exit edge post-dominates the entry
edge, and any cycle that includes one also includes the other.</p>
</dd>
</dl>
<p>For example, the basic block for the condition of an if statement dominates
all blocks in its <em>true</em> and <em>false</em> branches. Blocks for successor
statements to that conditional statement are also dominated. The same thing
holds for a while loop. So for CFGs generated from structured programs (and
specifically for those generated by
<a class="reference internal" href="#prodigy.pgcl.cfg.ControlFlowGraph.from_instructions" title="prodigy.pgcl.cfg.ControlFlowGraph.from_instructions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ControlFlowGraph.from_instructions()</span></code></a>), it suffices to concatenate
statements into a sequence as long as each statement dominates the next one.
The set of basic blocks in such a sequence is called a <em>region</em>
(<a class="reference internal" href="cfg_internals.html#prodigy.pgcl.cfg._Region" title="prodigy.pgcl.cfg._Region"><code class="xref py py-class docutils literal notranslate"><span class="pre">_Region</span></code></a>, see also <a class="reference internal" href="#fcd16" id="id4"><span>[fcd16]</span></a>).</p>
<p>Fortunately, this implementation can be restricted to these
program-generated CFGs and those modified by <a class="reference internal" href="#prodigy.pgcl.cfg.one_big_loop" title="prodigy.pgcl.cfg.one_big_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">one_big_loop()</span></code></a>. That
means we can create regions without problems for <em>almost all</em> basic blocks.
The only difficulty are generated trampoline blocks. We handle those
separately in an ugly method (<a class="reference internal" href="cfg_internals.html#prodigy.pgcl.cfg._join_regions" title="prodigy.pgcl.cfg._join_regions"><code class="xref py py-func docutils literal notranslate"><span class="pre">_join_regions()</span></code></a>).</p>
<p class="rubric">Restrictions and Generalizations</p>
<p>It is not completely clear what the above restrictions on input CFGs mean
formally. Ignoring trampoline blocks, the restrictions are more strict than
just having CFGs <em>reducible</em> <a class="footnote-reference brackets" href="#id11" id="id5">2</a>. On the other hand, a generalized
algorithm is a hard task, particularly for CFGs with arbitrary <cite>goto</cite>. The
<em>relooper</em> of <em>Emscripten</em> was an attempt in a production JS-to-LLVM
compiler <a class="reference internal" href="#zak11" id="id6"><span>[zak11]</span></a>. Iozzelli has revisited the problem for the <em>Cheerp</em>
compiler using a dominator tree-based approach <a class="reference internal" href="#ioz19" id="id7"><span>[ioz19]</span></a>. In their article,
some ideas implemented here are discovered independently (e.g. our
<a class="reference internal" href="#prodigy.pgcl.cfg.JumpTable" title="prodigy.pgcl.cfg.JumpTable"><code class="xref py py-class docutils literal notranslate"><span class="pre">JumpTable</span></code></a> under the name “dispatcher”). Their general algorithms
may be of interest for an improvement of this method <a class="footnote-reference brackets" href="#id12" id="id8">3</a> at the cost of a
much more complex implementation, although the current one hopefully
suffices.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p><a class="reference external" href="cfg_internals.html">Documentation of internal classes and functions</a> can be found on another page.</p>
</div>
<dl class="footnote brackets">
<dt class="label" id="id10"><span class="brackets"><a class="fn-backref" href="#id3">1</a></span></dt>
<dd><p>The attentive reader might notice that such an output would subsume <a class="reference internal" href="#prodigy.pgcl.cfg.one_big_loop" title="prodigy.pgcl.cfg.one_big_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">one_big_loop()</span></code></a> completely. Just applying the “folk theorem” would have been an easier way of implementation, but at the cost of almost completely unreadable output.</p>
</dd>
<dt class="label" id="id11"><span class="brackets"><a class="fn-backref" href="#id5">2</a></span></dt>
<dd><p>A <a class="reference external" href="https://en.wikipedia.org/wiki/Control-flow_graph#Reducibility">reducible</a> control-flow graph can be split into a directed acyclic graph of forward edges and a set of back edges where the target dominates the source.</p>
</dd>
<dt class="label" id="id12"><span class="brackets"><a class="fn-backref" href="#id8">3</a></span></dt>
<dd><p>In contrast to our pGCL programs, their reconstructed code is allowed to use <em>break</em> and <em>continue</em> statements.</p>
</dd>
</dl>
<dl class="citation">
<dt class="label" id="fcd16"><span class="brackets"><a class="fn-backref" href="#id4">fcd16</a></span></dt>
<dd><p>“<a class="reference external" href="https://zneak.github.io/fcd/2016/02/17/structuring.html">The Region Problem</a>”  on the <cite>fcd</cite> decompiler blog, 2016.</p>
</dd>
<dt class="label" id="zak11"><span class="brackets"><a class="fn-backref" href="#id6">zak11</a></span></dt>
<dd><p>“<a class="reference external" href="https://raw.githubusercontent.com/kripken/emscripten/8a6e2d67c156d9eaedf88b752be4d1cf4242e088/docs/paper.pdf">Emscripten: an LLVM-to-JavaScript compiler</a>”, Alon Zakai, OOPSLA ‘11.</p>
</dd>
<dt class="label" id="ioz19"><span class="brackets"><a class="fn-backref" href="#id7">ioz19</a></span></dt>
<dd><p>“<a class="reference external" href="https://medium.com/leaningtech/solving-the-structured-control-flow-problem-once-and-for-all-5123117b1ee2">Solving the structured control flow problem once and for all</a>”, Yuri Iozzelli, 2019.</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>graph</strong> (<a class="reference internal" href="#prodigy.pgcl.cfg.ControlFlowGraph" title="prodigy.pgcl.cfg.ControlFlowGraph"><code class="xref py py-class docutils literal notranslate"><span class="pre">ControlFlowGraph</span></code></a>) – </p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.List" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">List</span></code></a>[<a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Union" title="(in Python v3.10)"><code class="xref py py-data docutils literal notranslate"><span class="pre">Union</span></code></a>[<code class="xref py py-class docutils literal notranslate"><span class="pre">SkipInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">WhileInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">IfInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">AsgnInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ChoiceInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">LoopInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">TickInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ObserveInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ProbabilityQueryInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ExpectationInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PlotInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">PrintInstr</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">OptimizationQuery</span></code>]]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="prodigy.pgcl.cfg.program_one_big_loop">
<code class="sig-name descname"><span class="pre">program_one_big_loop</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">program</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pc_var</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/prodigy/pgcl/cfg.html#program_one_big_loop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#prodigy.pgcl.cfg.program_one_big_loop" title="Permalink to this definition">¶</a></dt>
<dd><p>Apply <a class="reference internal" href="#prodigy.pgcl.cfg.one_big_loop" title="prodigy.pgcl.cfg.one_big_loop"><code class="xref py py-func docutils literal notranslate"><span class="pre">one_big_loop()</span></code></a> to the CFG generated from the given instructions
(using <a class="reference internal" href="#prodigy.pgcl.cfg.ControlFlowGraph.from_instructions" title="prodigy.pgcl.cfg.ControlFlowGraph.from_instructions"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ControlFlowGraph.from_instructions()</span></code></a>), and convert back to a
list of instructions using <a class="reference internal" href="#prodigy.pgcl.cfg.reduce_cfg_to_instrs" title="prodigy.pgcl.cfg.reduce_cfg_to_instrs"><code class="xref py py-func docutils literal notranslate"><span class="pre">reduce_cfg_to_instrs()</span></code></a>.
A new program will be returned.</p>
<p>Use <cite>pc_var</cite> as the name of the generated variable (see <a class="reference internal" href="#prodigy.pgcl.cfg.JumpTable" title="prodigy.pgcl.cfg.JumpTable"><code class="xref py py-class docutils literal notranslate"><span class="pre">JumpTable</span></code></a>).
It must not be used already and will be added to the program’s declarations
by this function.</p>
<dl class="field-list simple">
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#AssertionError" title="(in Python v3.10)"><strong>AssertionError</strong></a> – if <cite>pc_var</cite> is already declared</p>
</dd>
<dt class="field-even">Parameters</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>program</strong> (<code class="xref py py-class docutils literal notranslate"><span class="pre">Program</span></code>) – </p></li>
<li><p><strong>pc_var</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) – </p></li>
</ul>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><code class="xref py py-class docutils literal notranslate"><span class="pre">Program</span></code></p>
</dd>
</dl>
</dd></dl>

</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="_sources/pgcl.rst.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2022, Lutz Klinkenberg.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.5.4.<br/>
    </p>
  </div>
</footer>
  </body>
</html>